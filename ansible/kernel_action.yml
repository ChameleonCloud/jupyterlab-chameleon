---
- hosts: KERNEL
  gather_facts: no
  pre_tasks:
    - name: "Installing core Jupyter libraries"
      ansible.builtin.pip:
        name: "{{ item }}"
      loop:
        - jupyter_core
        - jupyter_client
    - name: "Finding Python path"
      ansible.builtin.shell: which python
      register: python_path
    - name: "Finding Python path"
      set_fact:
        install_path: "{{ python_path.stdout | dirname }}"
    - name: "Installing subkernel agents"
      become: yes
      ansible.builtin.copy:
        src: bin/hydra-agent
        dest: "{{ install_path }}/hydra-agent"
        mode: preserve
    - name: "Installing subkernel agents"
      become: yes
      ansible.builtin.copy:
        src: bin/hydra-subkernel
        dest: "{{ install_path }}/hydra-subkernel"
        mode: preserve
  roles:
    - "{{ kernel_name }}"
